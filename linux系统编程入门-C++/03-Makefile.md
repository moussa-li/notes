[TOC]
# Makefile
## 命名 
makefile 或者 Makefile
## Makefile规则
一个Makefile文件中可以有一个或者多个规则

目标 ...: 依赖 ...
    命令 (shell命令)
    ...

- 目标：最终要生成的文件（伪目标除外）
- 依赖：生成目标所需要的文件或是目标
- 命令：通过执行命令对依赖操作生成目标

Makefile 中的其他规则一般都是为第一条规则服务的
## 工作原理
- 命令在执行之前，需要先检查规则中的依赖是否存在
    - 如果存在，执行命令
    - 如果不存在，向下检查其他的规则，检查有没有一个规则是用来生成这个依赖的，如果找到了，则执行该规则中的命令
- 检测更新，在执行规则中的命令时，会比较目标和依赖文件的时间
    - 如果依赖时间比目标的时间晚，需要重新生成目标
    - 如果依赖时间比目标的时间早，则目标不需要更新，对应规则中的命令不需要被执行

## 变量
### 自定义变量
```make
key=val
```

### 预定义变量
AR:归档维护程序的名称，默认值为ar
CC:C编译器的名称，默认值为gcc
CXX:C++编译器的名称，默认值为g++
$@:所有的目标件
$<:第一个依赖文件的名称
$^:所有的依赖文件
### 获取变量的值
$(变量名)

### 函数
$(wildcard PATTERN ...)
- 功能：获取指定目录下指定类型的文件
- 参数：PATTERN指的是某个或多个目录下对应的某种类型的文件
- 返回：得到的若干个文件的文件列表
- 示例：
    $(wildcard *.c ./path/*.c)

$(patsubst <pattern>,<replacement>,<text>)
- 功能：查找<text>中的单词匹配<pattern>，如果匹配，则以<replacement>替换
- 返回：函数返回被替换的字符串
- 示例：
    $(patsubst %.c, %.o, a.c b.c)
    返回-> a.o b.o


### 伪目标
定义的伪目标不会生成目标文件且不会检测
```Makefile
.PHONY:(目标名)
```

---
例子
```Makefile
src=a.o b.o c.o
target=app
$(target):$(src)
    $(CC) $(src) -o $(target)

%.o:%.c
    $(CC) -c $< -o $@
```